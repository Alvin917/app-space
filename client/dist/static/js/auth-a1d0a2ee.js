import{l as e,r as s,a as i}from"./loginApi-dd1ca793.js";import{n as t,F as o,G as r,x as a}from"./index-8ea49c21.js";import"./vueRouter-5522c294.js";const n={};var l=t({data:()=>({username:"",password:"",isLogin:!1,errorInfo:"",showType:"login",email:"",showLoading:!1}),created(){this.$nextTick((()=>{}))},components:{},methods:{onSubmit(){"login"===this.showType?this.login():"register"===this.showType?this.regist():this.requestPassword()},onRegister(){this.showType="register"===this.showType?"login":"register"},onForget(){this.$prompt("请输入邮箱,我们会发送新密码到您到邮箱","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/[\w!#$%&'*+/=?^_`{|}~-]+(?:\.[\w!#$%&'*+/=?^_`{|}~-]+)*@(?:[\w](?:[\w-]*[\w])?\.)+[\w](?:[\w-]*[\w])?/,inputErrorMessage:"邮箱格式不正确"}).then((({value:e})=>{this.email=e,this.requestPassword()})).catch((e=>{this.$message({type:"info",message:e})}))},login(){if(0===this.username.length)return void(this.errorInfo="* 用户名不能为空");if(0===this.password.length)return void(this.errorInfo="* 密码不能为空");this.errorInfo="";let s={username:this.username,password:this.password};this.showLoading=!0,e(s).then((e=>{console.log(e),this.showLoading=!1,o.add(this.axios.baseURL,e.data.token);let s={userName:this.username,userId:e.data._id,permission:e.data.permission,email:e.data.email,apiToken:e.data.apiToken};r(s),this.$router.push("/")}),(e=>{this.showLoading=!1}))},regist(){if(0===this.username.length)return void this.$message.error("用户名不能为空");if(0===this.email.length)return void this.$message.error("邮箱不能为空");if(!a.valideEmail(this.email))return void this.$message.error("邮箱格式错误");if(0===this.password.length)return void this.$message.error("密码不能为空");let e={username:this.username,password:this.password,email:this.email};this.showLoading=!0,s(e).then((e=>{this.showLoading=!1,console.log(e),this.$message({message:"恭喜你，注册成功",type:"success"}),setTimeout((()=>{this.onRegister()}),500)}),(e=>{this.showLoading=!1}))},requestPassword(){0!==this.email.length?i({email:this.email}).then((e=>{console.log(e),this.$message({message:"密码已重置,新密码已通过邮件发送至您的邮箱.",type:"success"})}),(e=>{console.log(e),this.$message.error(e)})):this.$message.error("邮箱不能为空")},clickSubItem(e){if("api"===e){let e=`${this.axios.defaults.baseURL}api/swagger`;window.open(e,"_blank")}if("help"===e){let e=`http://wiki.${this.axios.defaults.baseURL.replace("https://","").replace("http://","").replace("www.","")}`;console.log(e),window.open(e,"_blank")}if("github"===e){let e="https://github.com/HeadingMobile";window.open(e,"_blank")}e.index}}},(function(){var e=this,s=e.$createElement,i=e._self._c||s;return i("div",{staticClass:"user"},[i("div",{staticClass:"user-right"},[i("div",{staticClass:"user-login-panel"},["login"===e.showType?i("div",{staticClass:"user-login-title"},[i("p",[e._v(" 登录")])]):e._e(),"register"===e.showType?i("div",{staticClass:"user-login-title"},[i("p",[e._v(" 注册")])]):e._e(),"forget"===e.showType?i("div",{staticClass:"user-login-title"},[i("p",[e._v("找回密码")])]):e._e(),i("div",{class:["login"===e.showType?"user-login-form":"user-register-form"]},[i("el-input",{staticClass:"user-login-form-input",attrs:{type:"text",placeholder:"请输入用户名","prefix-icon":"icon-ic_name"},model:{value:e.username,callback:function(s){e.username=s},expression:"username"}}),"register"===e.showType?i("el-input",{staticClass:"user-login-form-input",attrs:{placeholder:"请输入邮箱",type:"email","prefix-icon":"icon-ic_email"},model:{value:e.email,callback:function(s){e.email=s},expression:"email"}}):e._e(),i("el-input",{staticClass:"user-login-form-input",attrs:{placeholder:"请输入密码",type:"password","prefix-icon":"icon-ic_pswd"},model:{value:e.password,callback:function(s){e.password=s},expression:"password"}}),i("el-button",{class:["login"===e.showType?"user-login-form-btn":"user-register-form-btn"],attrs:{type:"submit",loading:e.showLoading},on:{click:e.onSubmit}},[e._v(e._s("login"===e.showType?"立即登录":"立即注册")+" ")]),"login"===e.showType?i("div",{staticClass:"user-login-form-label"},[i("p",[i("span",{on:{click:e.onRegister}},[e._v("没有账号？立即注册")])])]):e._e(),"register"===e.showType?i("div",{staticClass:"user-login-form-label"},[i("p",[i("span",{on:{click:e.onRegister}},[e._v("已有账号？现在登录")])])]):e._e(),i("div",{staticClass:"user-login-form-label user-login-form-bottom"},[i("p",{on:{click:e.onForget}},[e._v("忘记密码")])])],1)])])])}),[],!1,h,null,null,null);function h(e){for(let s in n)this[s]=n[s]}var p=function(){return l.exports}();export{p as default};
